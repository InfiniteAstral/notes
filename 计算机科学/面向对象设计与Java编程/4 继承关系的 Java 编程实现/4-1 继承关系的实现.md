# 4.1 继承关系的实现

继承是面向对象编程的三大特性之一，它允许一个类（子类）继承另一个类（父类）的属性和方法。这不仅可以重用代码，还能建立类之间的层次关系，实现多态。

## 4.1.1 Java 继承的语法

### 继承的语法

在 Java 中，使用 `extends` 关键字来实现继承。

```java
class Animal {
    String name;

    public void eat() {
        System.out.println("动物在吃东西");
    }
}

class Dog extends Animal {
    public void bark() {
        System.out.println("小狗在汪汪叫");
    }
}
```

在上面的例子中，`Dog` 类继承了 `Animal` 类。这意味着 `Dog` 类自动拥有了 `Animal` 类的 `name` 属性和 `eat()` 方法。

```java
public class Main {
    public static void main(String[] args) {
        Dog myDog = new Dog();
        myDog.name = "旺财";
        System.out.println(myDog.name); // 输出 "旺财"
        myDog.eat();  // 输出 "动物在吃东西"
        myDog.bark(); // 输出 "小狗在汪汪叫"
    }
}
```

### 继承与 `super` 关键字

`super` 关键字用于从子类中访问父类的成员（属性和方法）。

1.  **访问父类的属性和方法**：如果子类和父类有同名的成员，可以使用 `super` 来区分。

    ```java
    class Animal {
        String name = "动物";

        public void eat() {
            System.out.println("动物在吃东西");
        }
    }

    class Dog extends Animal {
        String name = "小狗";

        public void showName() {
            System.out.println(name);       // 输出 "小狗"
            System.out.println(super.name); // 输出 "动物"
        }
    }
    ```

2.  **调用父类的构造函数**：`super()` 用于调用父类的构造函数。这必须是子类构造函数的第一条语句。

### 继承与构造函数

子类的构造函数在执行时，会默认先调用父类的无参构造函数。

```java
class Animal {
    Animal() {
        System.out.println("Animal 的构造函数被调用");
    }
}

class Dog extends Animal {
    Dog() {
        // 这里会隐式调用 super()
        System.out.println("Dog 的构造函数被调用");
    }
}

public class Main {
    public static void main(String[] args) {
        Dog myDog = new Dog();
        // 输出:
        // Animal 的构造函数被调用
        // Dog 的构造函数被调用
    }
}
```

如果父类没有无参构造函数，或者你想调用父类的带参构造函数，就必须在子类构造函数中显式地使用 `super()`。

```java
class Animal {
    String name;

    Animal(String name) {
        this.name = name;
        System.out.println("Animal 的带参构造函数被调用");
    }
}

class Dog extends Animal {
    Dog(String name) {
        super(name); // 必须显式调用父类带参构造函数
        System.out.println("Dog 的构造函数被调用");
    }
}
```

## 4.1.2 向上转型与向下转型

### 向上转型（Upcasting）

向上转型是指将子类的对象引用赋值给父类的引用变量。这是自动发生的，因为子类对象本身就是父类的一个实例。

```java
Dog myDog = new Dog();
Animal myAnimal = myDog; // 向上转型
```

向上转型后，`myAnimal` 引用只能调用 `Animal` 类中定义的方法，不能调用 `Dog` 类特有的方法。

```java
myAnimal.eat();  // 合法
// myAnimal.bark(); // 编译错误，因为 Animal 类没有 bark() 方法
```

向上转型是多态的基础。例如，我们可以创建一个 `Animal` 类型的数组，并存入不同的子类对象。

```java
Animal[] animals = new Animal[2];
animals[0] = new Dog();
animals[1] = new Cat(); // 假设还有一个 Cat 类继承自 Animal
```

### 向下转型（Downcasting）

向下转型是指将父类的引用变量强制转换为子类的引用变量。这需要显式地进行类型转换，并且存在风险。

```java
Dog myDog = new Dog();
Animal myAnimal = myDog; // 向上转型

Dog anotherDog = (Dog) myAnimal; // 向下转型
anotherDog.bark(); // 合法
```

如果父类引用指向的实际对象不是目标子类类型，向下转型会抛出 `ClassCastException` 异常。因此，在向下转型之前，最好使用 `instanceof` 关键字进行检查。

```java
if (myAnimal instanceof Dog) {
    Dog anotherDog = (Dog) myAnimal;
    anotherDog.bark();
}
```

## 4.1.3 继承关系中的方法重写

当子类需要修改从父类继承来的方法的行为时，就需要进行方法重写（Override）。

方法重写的规则：

- 方法名、参数列表必须与父类完全相同。
- 子类的返回类型必须与父类的返回类型相同或是其子类。
- 子类的访问修饰符不能比父类的更严格（例如，父类是 `public`，子类不能是 `protected`）。
- 建议使用 `@Override` 注解，这能让编译器检查是否满足重写规则。

```java
class Animal {
    public void eat() {
        System.out.println("动物在吃东西");
    }
}

class Dog extends Animal {
    @Override
    public void eat() {
        System.out.println("小狗在吃骨头");
    }
}
```

### `equals()` 方法的重写

`Object` 类是所有 Java 类的根父类。它的 `equals()` 方法默认比较的是两个对象的内存地址。在实际开发中，我们通常需要重写它来比较对象的内容。

例如，我们创建一个 `Person` 类，如果两个 `Person` 对象的 `id` 相同，我们就认为他们是同一个人。

```java
class Person {
    private String id;
    private String name;

    public Person(String id, String name) {
        this.id = id;
        this.name = name;
    }

    @Override
    public boolean equals(Object obj) {
        // 1. 检查是否为同一对象
        if (this == obj) {
            return true;
        }
        // 2. 检查 obj 是否为 null，以及类型是否匹配
        if (obj == null || getClass() != obj.getClass()) {
            return false;
        }
        // 3. 向下转型并比较内容
        Person person = (Person) obj;
        return id.equals(person.id);
    }
}
```

### `toString()` 方法的重写

`Object` 类的 `toString()` 方法默认返回对象的 "类名@哈希码" 字符串。我们通常重写它来返回更有意义的对象信息。

```java
class Person {
    private final String id;
    private final String name;

    public Person(String id, String name) {
        this.id = id;
        this.name = name;
    }

    @Override
    public String toString() {
        return "Person\{" + "id=\'" + id + '\'' + ", name=\'" + name + '\'' + '}';
    }
}

public class Main {
    public static void main(String[] args) {
        Person p = new Person("123", "张三");
        System.out.println(p); // 输出: Person{id='123', name='张三'}
    }
}
```
