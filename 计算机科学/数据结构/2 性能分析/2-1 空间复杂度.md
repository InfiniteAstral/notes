# 2.1 空间复杂度

<br>

## 2.2.1 空间复杂度的组成

程序所需要的空间主要由以下部分组成：

1. **指令空间** (instruction space)：编译后程序指令所需要的存储空间。
2. **数据空间** (data space)：程序运行时所需要的存储空间，由两个部分构成：
   - 常量和简单变量所需要的存储空间。
   - 动态数组和动态实例等动态对象所需要的空间。
3. **环境栈空间** (environment stack space)：用于保存暂停的函数和方法在恢复运行时所需要的信息。

<br>

## 2.2.2 指令空间

指令空间的数量取决于如下因素：

- 把程序转换成机器代码的编译器。
- 在编译时的编译器选项。
- 目标计算机。

其中编译器是决定代码需要多少空间最重要的因素。

以下是计算表达式 $a + b + b * c + (a + b - c) / (a + b) + 4$ 的三段可能的代码，每一个代码都由相应的编译器产生，但所需空间不一样。

1. ```asm
   LOAD a
   ADD b
   STORE t1
   LOAD b
   MULT c
   STORE t2
   LOAD t1
   ADD t2
   STORE t3
   LOAD a
   ADD b
   SUB c
   STORE t4
   LOAD a
   ADD b
   STORE t5
   LOAD t4
   DIV t5
   STORE t6
   LOAD t3
   ADD t6
   ADD 4
   ```
2. ```asm
   LOAD a
   ADD b
   STORE t1
   SUB c
   DIV t1
   STORE t2
   LOAD b
   MUL c
   STORE t3
   LOAD t1
   ADD t3
   ADD t2
   ADD 4
   ```
3. ```asm
   LOAD a
   ADD b
   STORE t1
   SUB c
   DIV t1
   STORE t2
   LOAD b
   MUL c
   ADD t2
   ADD t1
   ADD 4
   ```
   
即使采用相同的编译器，编译后的程序代码也可能不同。例如，一个编译器可能具备优化选项，如大小优化和执行时间优化等。在非优化模式下，编译器产生的是第 2 段代码，而在优化模式下，编译器可能利用知识 $a + b + b * c = b * c + (a + b)$ 而产生了第 3 段这样更短更高效的代码。不过，使用优化模式会增加程序编译的时间。

从代码示例中也可以看出，一个程序还可能需要额外的额外的空间，例如临时变量 `t1`、 `t2`、 `t3` 等。

编译器的**覆盖选项**也可以显著减少程序空间。在覆盖模式下，空间仅分配给当前正在执行的程序模块，调用其他模块需要从磁盘或其他设备读取，新模块将覆盖当前模块的空间。因此程序所需要的空间便是最大模块所需要的空间。

目标计算机的配置也会影响代码大小。如果计算机有浮点处理硬件，那么编译器就可以产生直接进行浮点操作的机器指令，否则就需要生成代码来模拟浮点操作。