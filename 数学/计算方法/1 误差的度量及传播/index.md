# 误差的度量及传播

## 误差的分类

- **舍入误差**：无限位数的数字只能用有限位数的数字来表示，所以会有舍入误差。

  示例：理论值为 $0.\dot{3}$，计算机中只能存储有限位数,如 $0.333333$。

- **截断误差**：使用不同方法近似计算所带来的误差。

  示例：理论值为 $e$，计算机中通过有限项 $1+\frac{1}{1!}+\frac{1}{2!}+\frac{1}{3!}$ 来计算。

- **观测误差**：由于测量设备的不精确或环境因素的影响，导致测量值与真实值之间的差异。

  示例：测量一个物体的长度，结果为 $10.2$ 米，而真实值为 $10.3$ 米。

由于存在舍入误差，所以**任何近似方法都不应该取非常小的值来近似**。

## 绝对误差、相对误差

- **绝对误差 $e$**：近似值与真值的差。
- **绝对误差限 $\varepsilon\ (\left | e \right | \le)$**：绝对误差的范围（取最后一位有效数字所在位的 $\frac{1}{2}$）

- **相对误差 $e_r$**：
  $$\frac{绝对误差}{真值（或近似值）}$$
- **相对误差限 $\varepsilon_r\ (\left | e_r \right | \le)$**：
  $$\frac{绝对误差限}{真值（或近似值）}$$

## 如何判断一个近似数的有效数字位数？

::: info 例
已知真值 $x=10\pi=31.415926\cdots$，近似值 $x_1^*=31.41$，$x_2^*=31.42$，$x_3^*=31.00$，$x_4^*=30.00$，判断各近似值的有效数字位数。
:::

下面以 $x_1^*=31.41$ 为例，说明如何判断有效数字位数。

### Step 1. 引入概念：量级

| 一个数的最高位所在位 | 该数的量级 $m$ |
| :------------------: | :------------: |
|       $\vdots$       |    $\vdots$    |
|         十位         |      $2$       |
|         个位         |      $1$       |
|        十分位        |      $0$       |
|        百分位        |      $-1$      |
|       $\vdots$       |    $\vdots$    |

所以 $x_1^*$ 的**量级为 $2$**。

### Step 2. 用“$5$”不断尝试，寻找一个数字

计算出 $e=x-x_1^*=0.005926\cdots$

1. **尝试 $0.5$**：

   $
   \begin{matrix}
    0 & . & 0 & 0 & 5 & 9 & 2 & 6 & \cdots\\
    0 & . & 5 &  &  &  &  &  &
   \end{matrix}
   $

2. 由于 $0.5>0.005826\cdots$，**接下来再尝试 $0.05$**：

   $
   \begin{matrix}
    0 & . & 0 & 0 & 5 & 9 & 2 & 6 & \cdots\\
    0 & . & 0 & 5 &  &  &  &  &
   \end{matrix}
   $

3. 由于 $0.05>0.005826\cdots$，**接下来再尝试 $0.005$**：

   $
   \begin{matrix}
    0 & . & 0 & 0 & 5 & 9 & 2 & 6 & \cdots\\
    0 & . & 0 & 0 & 5 &  &  &  &
   \end{matrix}
   $

4. 终于 $0.005<0.005826\cdots$，此时**停止尝试**。
5. 因此**寻找到的这个数字为最后一个大于 $e$ 的 $0.05$，即 $0.5\times 10^{-1}$**。

### Step 3. 求有效数字位数 $n$

**使用公式：$0.5\times 10^{m-n}$**，其中 $m$ 为 $x$ 的量级，$n$ 为要求的有效数字位数。

所以 $0.5\times 10^{-1} = 0.5\times 10^{m-n} = 0.5\times 10^{2-n}$，**解得有效数字位数为 $n=3$**。

::: tip 以此类推
使用上述的方法，可得到 $x_2^*$ 的有效数字位数为 $4$，$x_3^*$ 的有效数字位数为 $2$，$x_4^*$ 的有效数字位数为 $1$。

其中，$x_2^*$ 的有效数字位数为 $4$，同时 $x_2^*=31.42$ 本身就有 $4$ 位数字，这时就称 $x_2^*$ 为**有效数**。
:::

## 误差传播

若有函数 $y=f(x_1,x_2,\cdots,x_n)$，用含有误差的近似值 $x_1^*,x_2^*,\cdots,x_n^*$ 计算出的 $y^*$，其：

- **绝对误差**：
  $$e(y^*)=\sum_{i=1}^{n} {f_i}' e(x_i^*)$$
- **绝对误差限**：
  $$\varepsilon(y^*)=\sum_{i=1}^{n} {f_i}' \varepsilon (x_i^*)$$

- **相对误差**：
  $$e_r(y^*)=\frac{1}{y^*}\sum_{i=1}^{n} {f_i}' x_i^* e_r(x_i^*)$$
- **相对误差限**：
  $$\varepsilon_r(y^*)=\frac{1}{y^*}\sum_{i=1}^{n} {f_i}' x_i^* \varepsilon _r(x_i^*)$$

其中的 **${f_i}'$ 都为关于 $x_i^*$ 的偏导**。

## 算法设计原则

1. **避免相近数相减**。

   如果遇到应改写式子，如当 $x$ 很大时，左式应改为右式再进行计算：

   $$\ln{(x+1)}-\ln{x}\Rightarrow \ln\frac{x+1}{x}$$

   ::: tip 特别情况
   实在不能改写的，应考虑泰勒展开等方法。

   如 $x-\sin{x}$ （$x$ 充分小）。
   :::

2. **避免用绝对值过大的数加绝对值过小的数**。

   由于大数位数的影响，太小的数可能无法被正确表示。

3. **避免用绝对值过大的数除以绝对值过小的数**。

   结果可能溢出。
